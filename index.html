<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cell Calculator</title>

<style>
:root { color-scheme: light dark; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Arial, sans-serif;
  margin: 0;
  background: #000;
}

.wrap {
  max-width: 720px;
  margin: 0 auto;
  padding: 16px;
}

h1 {
  font-size: 20px;
  margin: 8px 0 16px;
}

.card {
  border: 1px solid rgba(127,127,127,.35);
  border-radius: 16px;
  padding: 18px;
  margin: 20px 0;
}

label {
  font-size: 12px;
  opacity: .8;
  display: block;
  margin-bottom: 6px;
}

input, select, button {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid rgba(127,127,127,.35);
  background: transparent;
  font-size: 15px;
}

button { cursor: pointer; }

.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.grid3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }

.out {
  font-size: 20px;
  font-weight: 600;
  margin-top: 8px;
  font-variant-numeric: tabular-nums;
}

.sub {
  font-size: 12px;
  opacity: .75;
  margin-top: 6px;
  line-height: 1.4;
}

.pill {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid rgba(127,127,127,.35);
  font-size: 12px;
  margin-bottom: 6px;
}

@media (max-width: 700px) {
  .grid2, .grid3 { grid-template-columns: 1fr; }
}
</style>
</head>

<body>
<div class="wrap">
  <h1>Cell Calculator</h1>

  <!-- Konzentration + Gesamtzellzahl -->
  <div class="card">
    <div class="grid2">
      <div>
        <label>Quelle der Konzentration</label>
        <select id="mode">
          <option value="hemo">Hämozytometer (Neubauer)</option>
          <option value="known">Konzentration bekannt</option>
        </select>
      </div>
      <div>
        <label>Rundung Pipettiervolumen</label>
        <select id="rounding">
          <option value="1">1 µL</option>
          <option value="5">5 µL</option>
          <option value="10" selected>10 µL</option>
          <option value="25">25 µL</option>
        </select>
      </div>
    </div>

    <div id="hemoBox" class="grid3" style="margin-top:16px;">
      <div>
        <label>Gezählte Zellen (Summe)</label>
        <input id="counts" value="100">
      </div>
      <div>
        <label>Anzahl großer Quadrate</label>
        <input id="squares" value="4">
      </div>
      <div>
        <label>Verdünnungsfaktor</label>
        <input id="dilution" value="2">
      </div>
    </div>

    <div id="knownBox" class="grid2" style="margin-top:16px; display:none;">
      <div>
        <label>Konzentration</label>
        <input id="concVal" value="1e6">
      </div>
      <div>
        <label>Einheit</label>
        <select id="concUnit">
          <option value="ml">Zellen/mL</option>
          <option value="ul">Zellen/µL</option>
        </select>
      </div>
    </div>

    <div class="grid2" style="margin-top:16px;">
      <div>
        <label>Volumen deiner aktuellen Zellsuspension (mL)</label>
        <input id="suspVolML" value="4.0">
      </div>
      <div>
        <label>Optional: nur Anzeige, keine Berechnung</label>
        <input disabled value="Total = (Zellen/mL) × (mL)">
      </div>
    </div>

    <div style="margin-top:18px;">
      <span class="pill">Konzentration</span>
      <div class="out" id="concOut">–</div>
      <div class="sub">
        Neubauer großes Quadrat = 10⁻⁴ mL → Faktor 10⁴
      </div>
    </div>

    <div style="margin-top:18px;">
      <span class="pill">Gesamtzellzahl in Suspension</span>
      <div class="out" id="totalCellsOut">–</div>
      <div class="sub" id="totalCellsSub"></div>
    </div>
  </div>

  <!-- Ziel -->
  <div class="card">
    <div class="grid3">
      <div>
        <label>Zielzellzahl</label>
        <input id="targetCells" value="200000">
      </div>
      <div>
        <label>Endvolumen (mL)</label>
        <input id="finalVol" value="">
      </div>
      <div>
        <label>Preset (Well Plate)</label>
        <select id="preset">
          <option value="">kein Preset</option>
          <option value="3.0">6-well (3.0 mL)</option>
          <option value="1.0">12-well (1.0 mL)</option>
          <option value="0.5">24-well (0.5 mL)</option>
          <option value="0.3">8-well (0.3 mL)</option>
          <option value="0.2">96-well (0.2 mL)</option>
        </select>
      </div>
    </div>

    <div class="grid2" style="margin-top:18px;">
      <div>
        <span class="pill">Zu pipettieren</span>
        <div class="out" id="pipOut">–</div>
        <div class="sub" id="pipSub"></div>
      </div>
      <div>
        <span class="pill">Medium auffüllen</span>
        <div class="out" id="medOut">–</div>
        <div class="sub">bis Endvolumen</div>
      </div>
    </div>

    <div class="grid2" style="margin-top:18px;">
      <button id="copyBtn">Pipettiervolumen kopieren</button>
      <button id="resetBtn">Reset</button>
    </div>
  </div>
</div>

<script>
const $ = id => document.getElementById(id);
const num = v => Number(String(v).replace(",", "."));

function concPerML() {
  if ($("mode").value === "hemo") {
    const c = num($("counts").value);
    const s = num($("squares").value);
    const d = num($("dilution").value) || 1;
    return s > 0 ? (c / s) * d * 1e4 : 0;
  } else {
    const v = num($("concVal").value);
    return $("concUnit").value === "ul" ? v * 1000 : v;
  }
}

function fmtInt(n) {
  if (!isFinite(n) || n <= 0) return "–";
  return Math.round(n).toLocaleString("de-DE");
}

function recompute() {
  $("hemoBox").style.display = $("mode").value === "hemo" ? "grid" : "none";
  $("knownBox").style.display = $("mode").value === "known" ? "grid" : "none";

  const c = concPerML();
  $("concOut").textContent = c > 0 ? c.toExponential(3) + " Zellen/mL" : "–";

  // Total cells in suspension
  const suspV = num($("suspVolML").value);
  const total = (c > 0 && suspV > 0) ? c * suspV : 0;
  $("totalCellsOut").textContent = total > 0 ? fmtInt(total) + " Zellen" : "–";
  $("totalCellsSub").textContent = (c > 0 && suspV > 0)
    ? `Rechnung: ${c.toExponential(3)} Zellen/mL × ${suspV.toFixed(3)} mL`
    : "";

  // Plating volume
  const target = num($("targetCells").value);
  const step = num($("rounding").value);
  const vol_uL = c > 0 ? (target / c) * 1000 : 0;
  const rounded = (step > 0) ? Math.round(vol_uL / step) * step : vol_uL;

  $("pipOut").textContent = rounded > 0 ? rounded.toFixed(1) + " µL" : "–";
  $("pipSub").textContent = rounded > 0 ? "exakt: " + vol_uL.toFixed(1) + " µL" : "";

  const finalV = num($("finalVol").value);
  $("medOut").textContent =
    finalV > 0 && rounded > 0
      ? (finalV - rounded / 1000).toFixed(3) + " mL"
      : "–";
}

$("preset").onchange = () => {
  if ($("preset").value) $("finalVol").value = $("preset").value;
  recompute();
};

[
  "mode","counts","squares","dilution","concVal","concUnit",
  "suspVolML",
  "targetCells","finalVol","rounding"
].forEach(id => $(id).addEventListener("input", recompute));

$("copyBtn").onclick = () =>
  navigator.clipboard.writeText($("pipOut").textContent);

$("resetBtn").onclick = () => location.reload();

recompute();
</script>
</body>
</html>
