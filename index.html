<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cell Calculator</title>

<style>
:root { color-scheme: light dark; }

body{
  font-family:-apple-system,BlinkMacSystemFont,"SF Pro Text",Arial,sans-serif;
  margin:0;
  background:#000;
}

.wrap{ max-width:860px; margin:0 auto; padding:16px; }
h1{ font-size:20px; margin:8px 0 6px; }
.version{ font-size:12px; opacity:.7; margin-bottom:14px; }

.card{
  border:1px solid rgba(127,127,127,.35);
  border-radius:16px;
  padding:18px;
  margin:20px 0;
}

label{ font-size:12px; opacity:.8; display:block; margin-bottom:6px; }

input,select,button{
  width:100%;
  padding:12px;
  border-radius:12px;
  border:1px solid rgba(127,127,127,.35);
  background:transparent;
  font-size:15px;
}

button{ cursor:pointer; }

.grid2{ display:grid; grid-template-columns:1fr 1fr; gap:14px; }
.grid3{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:14px; }

.out{
  font-size:20px;
  font-weight:600;
  margin-top:8px;
  font-variant-numeric:tabular-nums;
}

.sub{
  font-size:12px;
  opacity:.75;
  margin-top:6px;
  line-height:1.4;
}

.pill{
  display:inline-block;
  padding:4px 10px;
  border-radius:999px;
  border:1px solid rgba(127,127,127,.35);
  font-size:12px;
  margin-bottom:6px;
}

.table{
  width:100%;
  border-collapse:collapse;
  margin-top:12px;
  font-variant-numeric:tabular-nums;
}

.table th,.table td{
  text-align:left;
  padding:10px 8px;
  border-bottom:1px solid rgba(127,127,127,.22);
  vertical-align:top;
}

.badge-ok{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid rgba(127,127,127,.35);
  font-size:12px;
  margin-left:6px;
}

.badge-warn{
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  border:1px solid rgba(255,180,0,.6);
  font-size:12px;
  margin-left:6px;
}

@media (max-width: 760px){
  .grid2,.grid3{ grid-template-columns:1fr; }
}
</style>
</head>

<body>
<div class="wrap">
  <h1>Cell Calculator</h1>
  <div class="version">Version: 2026-01-14 13:22</div>

  <!-- Konzentration + Gesamtzellzahl -->
  <div class="card">
    <div class="grid2">
      <div>
        <label>Quelle der Konzentration</label>
        <select id="mode">
          <option value="hemo">Hämozytometer (Neubauer)</option>
          <option value="known">Konzentration bekannt</option>
        </select>
      </div>
    </div>

    <div id="hemoBox" class="grid3" style="margin-top:16px;">
      <div>
        <label>Gezählte Zellen (Summe)</label>
        <input id="counts" value="100">
      </div>
      <div>
        <label>Quadrate</label>
        <input id="squares" value="4">
      </div>
      <div>
        <label>Verdünnung</label>
        <input id="dilution" value="1">
      </div>
    </div>

    <div id="knownBox" class="grid2" style="margin-top:16px; display:none;">
      <div>
        <label>Konzentration</label>
        <input id="concVal" value="1e6">
      </div>
      <div>
        <label>Einheit</label>
        <select id="concUnit">
          <option value="ml">Zellen/mL</option>
          <option value="ul">Zellen/µL</option>
        </select>
      </div>
    </div>

    <div class="grid2" style="margin-top:16px;">
      <div>
        <label>Volumen Zellsuspension (mL)</label>
        <input id="suspVolML" value="4.0">
      </div>
      <div>
        <label>Hinweis</label>
        <input disabled value="Total = (Zellen/mL) × (mL)">
      </div>
    </div>

    <div style="margin-top:16px;">
      <span class="pill">Konzentration</span>
      <div class="out" id="concOut">–</div>
      <div class="sub">Neubauer großes Quadrat = 10⁻⁴ mL → Faktor 10⁴</div>
    </div>

    <div style="margin-top:16px;">
      <span class="pill">Gesamtzellzahl</span>
      <div class="out" id="totalCellsOut">–</div>
      <div class="sub" id="totalCellsSub"></div>
    </div>
  </div>

  <!-- Plating -->
  <div class="card">
    <div class="grid3">
      <div>
        <label>Zielzellzahl (pro Well/Dish)</label>
        <input id="targetCells" value="200000">
      </div>
      <div>
        <label>Endvolumen (mL)</label>
        <input id="finalVol" value="">
      </div>
      <div>
        <label>Preset (Well Plate)</label>
        <select id="preset">
          <option value="">kein Preset</option>
          <option value="3.0">6-well (3.0 mL)</option>
          <option value="1.0">12-well (1.0 mL)</option>
          <option value="0.5">24-well (0.5 mL)</option>
          <option value="0.3">8-well (0.3 mL)</option>
          <option value="0.2">96-well (0.2 mL)</option>
        </select>
      </div>
    </div>

    <div class="grid2" style="margin-top:18px;">
      <div>
        <span class="pill">Zu pipettieren</span>
        <div class="out" id="pipOut">–</div>
        <div class="sub" id="pipSub"></div>
      </div>
      <div>
        <span class="pill">Medium auffüllen</span>
        <div class="out" id="medOut">–</div>
        <div class="sub">bis Endvolumen</div>
      </div>
    </div>
  </div>

  <!-- Cryo -->
  <div class="card">
    <div class="grid2">
      <div>
        <label>Endvolumen pro Cryo (mL)</label>
        <input id="cryoVol" value="1.0">
      </div>
    </div>

    <table class="table">
      <thead>
        <tr>
          <th>Target</th>
          <th>Abnehmen</th>
          <th>Resuspend-Vorschlag</th>
        </tr>
      </thead>
      <tbody id="cryoTable"></tbody>
    </table>
  </div>

</div>

<script>
const $ = id => document.getElementById(id);
const num = v => Number(String(v).replace(",", "."));

function concPerML(){
  if ($("mode").value === "hemo"){
    const c = num($("counts").value);
    const s = num($("squares").value);
    const d = num($("dilution").value) || 1;
    return s > 0 ? (c / s) * d * 1e4 : 0;
  } else {
    const v = num($("concVal").value);
    return $("concUnit").value === "ul" ? v * 1000 : v;
  }
}

function fmtInt(n){
  return Math.round(n).toLocaleString("de-DE");
}

function recompute(){
  $("hemoBox").style.display = $("mode").value === "hemo" ? "grid" : "none";
  $("knownBox").style.display = $("mode").value === "known" ? "grid" : "none";

  const c = concPerML();
  $("concOut").textContent = c > 0 ? c.toExponential(3) + " Zellen/mL" : "–";

  const suspV = num($("suspVolML").value);
  const total = (c > 0 && suspV > 0) ? c * suspV : 0;

  $("totalCellsOut").textContent = total > 0 ? fmtInt(total) + " Zellen" : "–";
  $("totalCellsSub").textContent = total > 0 ? `${c.toExponential(3)} × ${suspV.toFixed(2)} mL` : "";

  // plating
  const target = num($("targetCells").value);
  const vol_uL = (c > 0 && target > 0) ? (target / c) * 1000 : 0;
  const volRounded = Math.round(vol_uL); // immer 1 µL

  $("pipOut").textContent = volRounded > 0 ? `${volRounded} µL` : "–";
  $("pipSub").textContent = volRounded > 0 ? `exakt: ${vol_uL.toFixed(2)} µL` : "";

  const finalV = num($("finalVol").value);
  $("medOut").textContent =
    (finalV > 0 && volRounded > 0)
      ? `${Math.max(0, finalV - (volRounded/1000)).toFixed(3)} mL`
      : "–";

  // cryo
  const cryoVol = num($("cryoVol").value);
  const targets = [
    {label:"1.000.000", cells:1000000},
    {label:"750.000",  cells:750000},
    {label:"500.000",  cells:500000},
  ];

  let rows = "";
  for (const t of targets){
    let take = "–";
    let resusp = "–";

    if (c > 0 && total > 0){
      if (Math.abs(total - t.cells) < 0.5){
        take = `gesamte Suspension <span class="badge-ok">exakt passend</span>`;
        resusp = `${cryoVol.toFixed(2)} mL<br><span class="sub">kein Zentrifugieren nötig</span>`;
      } else if (total >= t.cells){
        const need_uL = Math.round((t.cells / c) * 1000);
        take = `${need_uL} µL`;
        resusp = `${cryoVol.toFixed(2)} mL<br><span class="sub">Zellen ggf. pelletieren</span>`;
      } else {
        take = `– <span class="badge-warn">zu wenig Zellen</span>`;
        resusp = `<span class="sub">konzentrieren nötig</span>`;
      }
    }

    rows += `
      <tr>
        <td><strong>${t.label}</strong></td>
        <td>${take}</td>
        <td>${resusp}</td>
      </tr>`;
  }

  $("cryoTable").innerHTML = rows;
}

$("preset").onchange = () => {
  if ($("preset").value) $("finalVol").value = $("preset").value;
  recompute();
};

[
  "mode","counts","squares","dilution","concVal","concUnit",
  "suspVolML","targetCells","finalVol","cryoVol"
].forEach(id => $(id).addEventListener("input", recompute));

recompute();
</script>
</body>
</html>
