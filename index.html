<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Cell Calculator</title>

<style>
:root { color-scheme: light dark; }

body {
  font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", Arial, sans-serif;
  margin: 0;
  background: #000;
}

.wrap {
  max-width: 780px;
  margin: 0 auto;
  padding: 16px;
}

h1 {
  font-size: 20px;
  margin: 8px 0 16px;
}

.card {
  border: 1px solid rgba(127,127,127,.35);
  border-radius: 16px;
  padding: 18px;
  margin: 20px 0;
}

label {
  font-size: 12px;
  opacity: .8;
  display: block;
  margin-bottom: 6px;
}

input, select, button {
  width: 100%;
  padding: 12px;
  border-radius: 12px;
  border: 1px solid rgba(127,127,127,.35);
  background: transparent;
  font-size: 15px;
}

button { cursor: pointer; }

.grid2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
.grid3 { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 14px; }

.out {
  font-size: 20px;
  font-weight: 600;
  margin-top: 8px;
  font-variant-numeric: tabular-nums;
}

.sub {
  font-size: 12px;
  opacity: .75;
  margin-top: 6px;
  line-height: 1.4;
}

.pill {
  display: inline-block;
  padding: 4px 10px;
  border-radius: 999px;
  border: 1px solid rgba(127,127,127,.35);
  font-size: 12px;
  margin-bottom: 6px;
}

.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 12px;
  font-variant-numeric: tabular-nums;
}

.table th, .table td {
  text-align: left;
  padding: 10px 8px;
  border-bottom: 1px solid rgba(127,127,127,.22);
  vertical-align: top;
}

.badge-ok {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(127,127,127,.35);
  font-size: 12px;
  margin-left: 6px;
}

.badge-warn {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  border: 1px solid rgba(255,180,0,.6);
  font-size: 12px;
  margin-left: 6px;
}

@media (max-width: 700px) {
  .grid2, .grid3 { grid-template-columns: 1fr; }
}
</style>
</head>

<body>
<div class="wrap">
<h1>Cell Calculator</h1>

<!-- Konzentration -->
<div class="card">
  <div class="grid2">
    <div>
      <label>Quelle der Konzentration</label>
      <select id="mode">
        <option value="hemo">Hämozytometer (Neubauer)</option>
        <option value="known">Konzentration bekannt</option>
      </select>
    </div>
    <div>
      <label>Rundung Pipettiervolumen</label>
      <select id="rounding">
        <option value="1">1 µL</option>
        <option value="5">5 µL</option>
        <option value="10" selected>10 µL</option>
      </select>
    </div>
  </div>

  <div id="hemoBox" class="grid3" style="margin-top:16px;">
    <div><label>Gezählte Zellen</label><input id="counts" value="100"></div>
    <div><label>Quadrate</label><input id="squares" value="4"></div>
    <div><label>Verdünnung</label><input id="dilution" value="1"></div>
  </div>

  <div class="grid2" style="margin-top:16px;">
    <div>
      <label>Volumen Zellsuspension (mL)</label>
      <input id="suspVolML" value="4.0">
    </div>
    <div>
      <label>Hinweis</label>
      <input disabled value="Total = (Zellen/mL) × (mL)">
    </div>
  </div>

  <div style="margin-top:16px;">
    <span class="pill">Konzentration</span>
    <div class="out" id="concOut">–</div>
  </div>

  <div style="margin-top:16px;">
    <span class="pill">Gesamtzellzahl</span>
    <div class="out" id="totalCellsOut">–</div>
    <div class="sub" id="totalCellsSub"></div>
  </div>
</div>

<!-- Freezing -->
<div class="card">
  <div class="grid2">
    <div>
      <label>Endvolumen pro Cryo (mL)</label>
      <input id="cryoVol" value="1.0">
    </div>
    <div>
      <label>Rundung Abnahme</label>
      <select id="cryoRound">
        <option value="1">1 µL</option>
        <option value="5" selected>5 µL</option>
      </select>
    </div>
  </div>

  <table class="table">
    <thead>
      <tr>
        <th>Target</th>
        <th>Abnehmen</th>
        <th>Resuspend-Vorschlag</th>
      </tr>
    </thead>
    <tbody id="cryoTable"></tbody>
  </table>
</div>

</div>

<script>
const $ = id => document.getElementById(id);
const num = v => Number(String(v).replace(",", "."));

function concPerML() {
  const c = num($("counts").value);
  const s = num($("squares").value);
  const d = num($("dilution").value) || 1;
  return s > 0 ? (c / s) * d * 1e4 : 0;
}

function fmt(n) {
  return Math.round(n).toLocaleString("de-DE");
}

function recompute() {
  const c = concPerML();
  $("concOut").textContent = c > 0 ? c.toExponential(3) + " Zellen/mL" : "–";

  const suspV = num($("suspVolML").value);
  const total = c * suspV;

  $("totalCellsOut").textContent = total > 0 ? fmt(total) + " Zellen" : "–";
  $("totalCellsSub").textContent =
    total > 0 ? `${c.toExponential(3)} × ${suspV.toFixed(2)} mL` : "";

  const cryoVol = num($("cryoVol").value);
  const step = num($("cryoRound").value);

  const targets = [
    1000000,
    750000,
    500000
  ];

  let rows = "";
  for (const t of targets) {
    let takeText = "–";
    let resuspText = "–";

    if (total > 0) {
      if (Math.abs(total - t) < 1) {
        takeText = "gesamte Suspension <span class='badge-ok'>exakt passend</span>";
        resuspText = `${cryoVol.toFixed(2)} mL<br><span class="sub">kein Zentrifugieren nötig</span>`;
      } else if (total > t) {
        const needML = t / c;
        takeText = (needML * 1000).toFixed(1) + " µL";
        resuspText =
          `${cryoVol.toFixed(2)} mL<br><span class="sub">Zellen ggf. pelletieren</span>`;
      } else {
        resuspText =
          `<span class="badge-warn">zu wenig Zellen</span><br>
           <span class="sub">konzentrieren nötig</span>`;
      }
    }

    rows += `
      <tr>
        <td><strong>${fmt(t)}</strong></td>
        <td>${takeText}</td>
        <td>${resuspText}</td>
      </tr>`;
  }

  $("cryoTable").innerHTML = rows;
}

[
  "counts","squares","dilution","suspVolML","cryoVol","cryoRound"
].forEach(id => $(id).addEventListener("input", recompute));

recompute();
</script>
</body>
</html>
